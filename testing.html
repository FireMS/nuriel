<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        .window {
            width: 400px;
            height: 300px;
            border: 2px solid black;
            background-color: #C0C0C0;
            position: absolute;
            font-family: 'Courier New', Courier, monospace;
            user-select: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .window-header {
            background-color: #0066CC;
            color: white;
            padding: 10px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .window-header .close-btn {
            width: 20px;
            height: 20px;
            background-color: red;
            color: white;
            font-weight: bold;
            text-align: center;
            line-height: 20px;
            border-radius: 2px;
            cursor: pointer;
        }
        .window-content {
            background-color: white;
            height: calc(100% - 40px);
            padding: 10px;
            overflow-y: auto;
            font-size: 12px;
        }
        .resizer {
            width: 10px;
            height: 10px;
            background-color: #0066CC;
            position: absolute;
            bottom: 0;
            right: 0;
            cursor: se-resize;
        }
        .draggable {
            width: 64px;
            height: 64px;
            position: absolute;
            background-size: cover;
            user-select: none;
        }
        .text {
            position: absolute;
            text-align: center;
            font-family: 'Comic Sans MS', cursive;
            user-select: none;
        }
        .mobile-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            font-size: 72px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .mode-toggle {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background-color: #0066CC;
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .mode-label {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div class="mobile-message" id="mobileMessage">Mobile not supported yet, sorry :(</div>

    <!-- Journal 1 -->
    <div class="draggable" id="draggable1"></div>
    <div class="text" id="text1">placeholder</div>

    <!-- Journal 2 -->
    <div class="draggable" id="draggable2"></div>
    <div class="text" id="text2">dialogue</div>

    <!-- Light/Dark Mode Toggle -->
    <div class="mode-toggle" id="modeToggle">toggle mode</div>
    <div class="mode-label" id="modeLabel">Light Mode</div>

    <script>
        const imageUrls = ['https://raw.githubusercontent.com/FireMS/nuriel/main/journals/journal.png'];
        const draggables = [
            document.getElementById('draggable1'),
            document.getElementById('draggable2')
        ];
        const texts = [
            document.getElementById('text1'),
            document.getElementById('text2')
        ];
        let isDraggingWindow = false;
        let journalStates = [false, false];

        //mobile check
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (isMobile) {
            document.getElementById('mobileMessage').style.display = 'flex';
        } else {
            document.getElementById('mobileMessage').style.display = 'none';
        }

        for (let i = 0; i < draggables.length; i++) {
            draggables[i].style.backgroundImage = `url(${imageUrls[0]})`;
            loadPosition(i); // load position from cookie
            draggables[i].addEventListener('dblclick', (event) => openJournalWindow(event, i));
            draggables[i].addEventListener('mousedown', (event) => {
                if (!isDraggingWindow) dragStart(event, i);
            });
        }

        // Load position from localStorage
        function loadPosition(id) {
            const savedPosition = JSON.parse(localStorage.getItem(`folder${id}Position`));
            if (savedPosition) {
                draggables[id].style.left = savedPosition.x + 'px';
                draggables[id].style.top = savedPosition.y + 'px';
                updateTextPosition(draggables[id], texts[id]);
            } else {
                let randomX = Math.floor(Math.random() * (window.innerWidth - 100));
                let randomY = Math.floor(Math.random() * (window.innerHeight - 90));
                draggables[id].style.left = randomX + 'px';
                draggables[id].style.top = randomY + 'px';
                updateTextPosition(draggables[id], texts[id]);
            }
        }

        // Save position to localStorage
        function savePosition(id) {
            const position = {
                x: parseInt(draggables[id].style.left),
                y: parseInt(draggables[id].style.top)
            };
            localStorage.setItem(`folder${id}Position`, JSON.stringify(position));
        }

        // Toggle Light/Dark Mode
        const modeToggle = document.getElementById('modeToggle');
        const modeLabel = document.getElementById('modeLabel');
        let isDarkMode = false;

        modeToggle.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            document.body.style.backgroundColor = isDarkMode ? '#222' : '#fff';
            document.body.style.color = isDarkMode ? '#fff' : '#000';
            modeToggle.style.backgroundColor = isDarkMode ? '#444' : '#0066CC';
            modeToggle.style.color = isDarkMode ? '#fff' : '#fff';
            modeLabel.textContent = isDarkMode ? 'Dark Mode' : 'Light Mode';
        });

        // Update text relative to journals
        function updateTextPosition(draggable, text) {
            const folderRect = draggable.getBoundingClientRect();
            const textLeft = folderRect.left + (folderRect.width - text.offsetWidth) / 2;
            text.style.left = textLeft + 'px';
            text.style.top = folderRect.bottom + 'px';
        }

        let offsets = {};
        let isDragging = [];

        function dragStart(event, id) {
            isDragging[id] = true;
            const rect = draggables[id].getBoundingClientRect();
            offsets[id] = { x: event.clientX - rect.left, y: event.clientY - rect.top };
        }

        document.addEventListener('mousemove', (event) => {
            for (let i = 0; i < draggables.length; i++) {
                if (isDragging[i]) {
                    let newX = event.clientX - offsets[i].x;
                    let newY = event.clientY - offsets[i].y;
                    newX = Math.max(0, Math.min(newX, window.innerWidth - 64));
                    newY = Math.max(0, Math.min(newY, window.innerHeight - 64));
                    draggables[i].style.left = newX + 'px';
                    draggables[i].style.top = newY + 'px';
                    updateTextPosition(draggables[i], texts[i]);
                }
            }
        });

        document.addEventListener('mouseup', () => {
            for (let i = 0; i < draggables.length; i++) {
                if (isDragging[i]) {
                    isDragging[i] = false;
                    savePosition(i);
                }
            }
        });
    </script>
</body>
</html>
